---
format: gfm
---

<!-- README.md is generated from README.Qmd. Please edit that file -->

```{r}
#| label: setup
#| include: false
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# Estimating trends in phenology

<!-- badges: start -->

[![Project Status: Active – The project has reached a stable, usable state and is being actively developed.](https://www.repostatus.org/badges/latest/active.svg)](https://www.repostatus.org/#active)
[![DOI](https://zenodo.org/badge/889180921.svg)](https://doi.org/10.5281/zenodo.17087407)

<!-- badges: end -->

The goal of this project is to estimate spatial and temporal trends in phenology in the Northeastern US using [PRISM](https://prism.oregonstate.edu/) temperature data.
This analytical pipeline downloads daily data, calculates growing degree days (GDD) for each day, and then finds the day of year (DOY) that certain threshold GDD are reached for this region. 
It then uses DOY as a response variable in pixel-wise linear regressions to explore spatio-temporal trends.

## Reproducibility

This workflow requires a lot of computational power and disk space.  Currently it runs on a Jetstream2 instance with 16 cores and 60GB of ram on a 500GB disk.  Even then, the disk occasionally fills up and the temp directory needs to be manually cleared out as intermediate tiff files accumulate.  I've used a `.Renviron` file to set the `TMPDIR` variable to make sure `tmpdir()` is on a large enough attached volume rather than the root disk, which for Jetstream2 is only 50GB.

This project was created with R version 4.4.2.

### `renv`

This project uses [`renv`](https://rstudio.github.io/renv/articles/renv.html) for package management.
When opening this repo as an RStudio Project for the first time, `renv` should automatically install itself and prompt you to run `renv::restore()` to install all package dependencies.
If you have any issues with `renv::restore()`, you may want to ensure you are using the same version of R (4.4.2)—[rig](https://github.com/r-lib/rig) is an excellent tool for managing different R versions.

### `targets`

This project uses the [`targets` package](https://docs.ropensci.org/targets/) for workflow management.
Run `targets::tar_make()` from the console to run the workflow and reproduce all results.
The graph below shows the workflow:

```{r}
#| label: tar_mermaid
#| echo: false
#| message: false
#| warning: false
#| results: asis
cat(
  "```mermaid",
  targets::tar_mermaid(targets_only = TRUE, reporter = "silent"),
  "```",
  sep = "\n"
)
#this should display correctly on GitHub, or code can be pasted into https://mermaid.live
```

### PRISM API

In the process of writing this manuscript, the PRISM API changed ([new API documentation](https://prism.oregonstate.edu/documents/PRISM_downloads_web_service.pdf)).
The current `targets` pipeline won't work with the new API, but we've provided a function, `get_prism2()` that should be a drop-in replacement wherever `get_prism()` is used.

------------------------------------------------------------------------

Developed in collaboration with the University of Arizona [CCT Data Science](https://datascience.cct.arizona.edu/) group.
